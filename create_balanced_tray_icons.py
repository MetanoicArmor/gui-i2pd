#!/usr/bin/env python3
"""
–°–æ–∑–¥–∞–Ω–∏–µ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∫–æ–Ω–æ–∫ —Ç—Ä–µ—è - –∑–æ–ª–æ—Ç–∞—è —Å–µ—Ä–µ–¥–∏–Ω–∞ –º–µ–∂–¥—É –º–∞–ª–µ–Ω—å–∫–∏–º–∏ –∏ –±–æ–ª—å—à–∏–º–∏
"""

from PIL import Image, ImageDraw, ImageFont
import os

def create_balanced_tray_icons():
    """–°–æ–∑–¥–∞–µ—Ç —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∫–æ–Ω–∫–∏ —Ç—Ä–µ—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞"""
    
    print("üì± –°–æ–∑–¥–∞–Ω–∏–µ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∫–æ–Ω–æ–∫ —Ç—Ä–µ—è...")
    print("‚öñÔ∏è –ü–æ–∏—Å–∫ –∑–æ–ª–æ—Ç–æ–π —Å–µ—Ä–µ–¥–∏–Ω—ã –º–µ–∂–¥—É –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç—å—é –∏ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å—é!")
    
    # –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã - –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç—å—é –∏ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å—é
    icon_sizes = [17, 18]  # –ö–æ–º–ø—Ä–æ–º–∏—Å—Å–Ω—ã–π —Ä–∞–∑–º–µ—Ä
    
    for icon_size in icon_sizes:
        print(f"\nüì± –°–æ–∑–¥–∞–Ω–∏–µ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∏–∫–æ–Ω–∫–∏ {icon_size}x{icon_size} –ø–∏–∫—Å–µ–ª–µ–π...")
        
        # –°–æ–∑–¥–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        img = Image.new('RGBA', (icon_size, icon_size), (0, 0, 0, 0))  # –ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω
        draw = ImageDraw.Draw(img)
        
        # –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –º–µ–∂–¥—É –º–∞–ª–µ–Ω—å–∫–∏–º –∏ –±–æ–ª—å—à–∏–º
        balanced_font_sizes = {
            17: 10,  # –ö–æ–º–ø—Ä–æ–º–∏—Å—Å–Ω—ã–π —à—Ä–∏—Ñ—Ç –¥–ª—è 17px
            18: 11   # –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —à—Ä–∏—Ñ—Ç –¥–ª—è 18px
        }
        
        font_size = balanced_font_sizes.get(icon_size, 11)
        
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π —à—Ä–∏—Ñ—Ç
        try:
            try:
                font = ImageFont.truetype("/System/Library/Fonts/Arial.ttf", font_size)
            except:
                try:
                    font = ImageFont.truetype("/System/Library/Fonts/Helvetica.ttc", font_size)
                except:
                    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–π —à—Ä–∏—Ñ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                    font = ImageFont.load_default()
        except:
            font = ImageFont.load_default()
        
        # –¢–µ–∫—Å—Ç "I2P" - –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
        text = "I2P"
        
        # –ü–æ–ª—É—á–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã —Ç–µ–∫—Å—Ç–∞
        try:
            bbox = draw.textbbox((0, 0), text, font=font)
            text_width = bbox[2] - bbox[0]
            text_height = bbox[3] - bbox[1]
        except:
            # –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ fallback —Ä–∞–∑–º–µ—Ä—ã
            text_width = len(text) * (font_size * 0.7)
            text_height = font_size
        
        # –¢–æ—á–Ω–æ–µ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
        x = (icon_size - text_width) // 2
        y = (icon_size - text_height) // 2 - 1
        
        # –ß–µ—Ç–∫–∏–π —á–µ—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è —Å–≤–µ—Ç–ª—ã—Ö —Ç–µ–º (—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç–µ–Ω—å)
        draw.text((x, y), text, fill=(0, 0, 0, 255), font=font)
        
        # –£–º–µ—Ä–µ–Ω–Ω–∞—è —Ç–µ–Ω—å –¥–ª—è —á–µ—Ç–∫–æ—Å—Ç–∏ –±–µ–∑ —É–≤–µ–ª–∏—á–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞
        shadow_color = (255, 255, 255, 12)
        draw.text((x + 1, y + 1), text, fill=shadow_color, font=font)
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Å–Ω–æ–≤–Ω—É—é —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∏–∫–æ–Ω–∫—É
        if icon_size == 18:  # –û—Å–Ω–æ–≤–Ω–æ–π —Ä–∞–∑–º–µ—Ä –¥–ª—è —Ç—Ä–µ—è
            img.save("iconset-work/tray-icon.png", "PNG")
            print(f"   ‚úÖ –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏–∫–æ–Ω–∫–∞ {icon_size}x{icon_size}")
        
        # –°–æ–∑–¥–∞–µ–º —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é –¥–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã
        img_inv = Image.new('RGBA', (icon_size, icon_size), (0, 0, 0, 0))  # –ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω
        draw_inv = ImageDraw.Draw(img_inv)
        
        # –ß–µ—Ç–∫–∏–π –±–µ–ª—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è —Ç–µ–º–Ω—ã—Ö —Ç–µ–º
        draw_inv.text((x, y), text, fill=(255, 255, 255, 255), font=font)
        # –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç–µ–Ω—å –¥–ª—è —Ç–µ–º–Ω—ã—Ö —Ç–µ–º
        shadow_color_inv = (0, 0, 0, 12)
        draw_inv.text((x + 1, y + 1), text, fill=shadow_color_inv, font=font)
        
        if icon_size == 18:
            img_inv.save("iconset-work/tray-icon-dark.png", "PNG")
            print(f"   ‚úÖ –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç–µ–º–Ω–∞—è –∏–∫–æ–Ω–∫–∞ {icon_size}x{icon_size}")
        
        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã
        filename = f"iconset-work/tray-icon-{icon_size}x{icon_size}-balanced.png"
        img.save(filename, "PNG")
        filename_inv = f"iconset-work/tray-icon-{icon_size}x{icon_size}-dark-balanced.png"
        img_inv.save(filename_inv, "PNG")
    
    print("\n‚ú® –°–æ–∑–¥–∞–Ω—ã —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∫–æ–Ω–∫–∏!")
    print("üìÅ –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Ç—Ä–µ—è:")
    print("   üì± tray-icon.png - —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏–∫–æ–Ω–∫–∞ (—á–∏—Ç–∞–µ–º–∞—è –∏ –∫–æ–º–ø–∞–∫—Ç–Ω–∞—è)")
    print("   üåô tray-icon-dark.png - —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç–µ–º–Ω–∞—è –∏–∫–æ–Ω–∫–∞ (—á–∏—Ç–∞–µ–º–∞—è –∏ –∫–æ–º–ø–∞–∫—Ç–Ω–∞—è)")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤
    balanced_files = ["tray-icon.png", "tray-icon-dark.png"]
    print("\nüìä –†–∞–∑–º–µ—Ä—ã —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:")
    for filename in balanced_files:
        filepath = f"iconset-work/{filename}"
        if os.path.exists(filepath):
            size = os.path.getsize(filepath)
            print(f"   ‚úÖ {filename}: {size} –±–∞–π—Ç (—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)")
    
    print("\n‚öñÔ∏è –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∫–æ–Ω–æ–∫:")
    print("   ‚úÖ –ö–æ–º–ø—Ä–æ–º–∏—Å—Å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏")
    print("   ‚úÖ –†–∞–∑–º–µ—Ä –º–µ–∂–¥—É —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∏–º –∏ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–º")
    print("   ‚úÖ –£–º–µ—Ä–µ–Ω–Ω—ã–µ —Ç–µ–Ω–∏ –¥–ª—è —á–µ—Ç–∫–æ—Å—Ç–∏ –±–µ–∑ –∑–∞—Å–æ—Ä–µ–Ω–∏—è")
    print("   ‚úÖ –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ —Ç—Ä–µ—è")
    
    return True

if __name__ == "__main__":
    try:
        success = create_balanced_tray_icons()
        if success:
            print("\n‚úÖ –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∫–æ–Ω–∫–∏ —Å–æ–∑–¥–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ!")
            print("üöÄ –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞!")
        else:
            print("\n‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∫–æ–Ω–∫–∏")
            exit(1)
    except Exception as e:
        print(f"\n‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∫–æ–Ω–æ–∫: {e}")
        exit(1)
