#!/usr/bin/env python3
"""
–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–∞–∫—Ç–Ω—ã—Ö –∏–∫–æ–Ω–æ–∫ —Ç—Ä–µ—è —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º —Ä–∞–∑–º–µ—Ä–æ–º
"""

from PIL import Image, ImageDraw, ImageFont
import os

def create_compact_tray_icons():
    """–°–æ–∑–¥–∞–µ—Ç —Å–∞–º—ã–π –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –∏–∫–æ–Ω–æ–∫ —Ç—Ä–µ—è"""
    
    print("üì± –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–∞–∫—Ç–Ω—ã—Ö –∏–∫–æ–Ω–æ–∫ —Ç—Ä–µ—è...")
    print("üéØ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Ç—Ä–µ—è macOS!")
    
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–µ–Ω—å—à–∏–µ —Ä–∞–∑–º–µ—Ä—ã –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏–∫–æ–Ω–∫–∏
    icon_sizes = [16, 18]  # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –¥–ª—è —Ç—Ä–µ—è
    
    for icon_size in icon_sizes:
        print(f"\nüì± –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–∞–∫—Ç–Ω–æ–π –∏–∫–æ–Ω–∫–∏ {icon_size}x{icon_size} –ø–∏–∫—Å–µ–ª–µ–π...")
        
        # –°–æ–∑–¥–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        img = Image.new('RGBA', (icon_size, icon_size), (0, 0, 0, 0))  # –ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω
        draw = ImageDraw.Draw(img)
        
        # –û—á–µ–Ω—å –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π —à—Ä–∏—Ñ—Ç –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
        compact_font_sizes = {
            16: 9,   # –û—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏–π —à—Ä–∏—Ñ—Ç –¥–ª—è 16px
            18: 11   # –ú–∞–ª–µ–Ω—å–∫–∏–π —à—Ä–∏—Ñ—Ç –¥–ª—è 18px
        }
        
        font_size = compact_font_sizes.get(icon_size, 10)
        
        # –ü—ã—Ç–∞–µ–º—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π —à—Ä–∏—Ñ—Ç
        try:
            try:
                font = ImageFont.truetype("/System/Library/Fonts/Arial.ttf", font_size)
            except:
                try:
                    font = ImageFont.truetype("/System/Library/Fonts/Helvetica.ttc", font_size)
                except:
                    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–π —à—Ä–∏—Ñ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                    font = ImageFont.load_default()
        except:
            font = ImageFont.load_default()
        
        # –¢–µ–∫—Å—Ç "I2P" - –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
        text = "I2P"
        
        # –ü–æ–ª—É—á–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã —Ç–µ–∫—Å—Ç–∞
        try:
            bbox = draw.textbbox((0, 0), text, font=font)
            text_width = bbox[2] - bbox[0]
            text_height = bbox[3] - bbox[1]
        except:
            # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ fallback —Ä–∞–∑–º–µ—Ä—ã
            text_width = len(text) * (font_size * 0.6)
            text_height = font_size
        
        # –¢–æ—á–Ω–æ —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ç–µ–∫—Å—Ç
        x = (icon_size - text_width) // 2
        y = (icon_size - text_height) // 2 - 1
        
        # –ß–µ—Ç–∫–∏–π —á–µ—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è —Å–≤–µ—Ç–ª—ã—Ö —Ç–µ–º (–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–Ω—å)
        draw.text((x, y), text, fill=(0, 0, 0, 255), font=font)
        
        # –û—á–µ–Ω—å –ª–µ–≥–∫–∞—è —Ç–µ–Ω—å –¥–ª—è —á–µ—Ç–∫–æ—Å—Ç–∏ (–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è)
        shadow_color = (255, 255, 255, 8)
        draw.text((x + 1, y + 1), text, fill=shadow_color, font=font)
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –∫–æ–º–ø–∞–∫—Ç–Ω—É—é –∏–∫–æ–Ω–∫—É
        if icon_size == 18:  # –û—Å–Ω–æ–≤–Ω–æ–π —Ä–∞–∑–º–µ—Ä –¥–ª—è —Ç—Ä–µ—è
            img.save("iconset-work/tray-icon.png", "PNG")
            print(f"   ‚úÖ –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è –∏–∫–æ–Ω–∫–∞ {icon_size}x{icon_size}")
        
        # –°–æ–∑–¥–∞–µ–º –∫–æ–º–ø–∞–∫—Ç–Ω—É—é –∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é –¥–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã
        img_inv = Image.new('RGBA', (icon_size, icon_size), (0, 0, 0, 0))  # –ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω
        draw_inv = ImageDraw.Draw(img_inv)
        
        # –ß–µ—Ç–∫–∏–π –±–µ–ª—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è —Ç–µ–º–Ω—ã—Ö —Ç–µ–º
        draw_inv.text((x, y), text, fill=(255, 255, 255, 255), font=font)
        # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–Ω—å –¥–ª—è —Ç–µ–º–Ω—ã—Ö —Ç–µ–º
        shadow_color_inv = (0, 0, 0, 8)
        draw_inv.text((x + 1, y + 1), text, fill=shadow_color_inv, font=font)
        
        if icon_size == 18:
            img_inv.save("iconset-work/tray-icon-dark.png", "PNG")
            print(f"   ‚úÖ –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è —Ç–µ–º–Ω–∞—è –∏–∫–æ–Ω–∫–∞ {icon_size}x{icon_size}")
        
        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã
        filename = f"iconset-work/tray-icon-{icon_size}x{icon_size}-compact.png"
        img.save(filename, "PNG")
        filename_inv = f"iconset-work/tray-icon-{icon_size}x{icon_size}-dark-compact.png"
        img_inv.save(filename_inv, "PNG")
    
    print("\n‚ú® –°–æ–∑–¥–∞–Ω—ã –∫–æ–º–ø–∞–∫—Ç–Ω—ã–µ –∏–∫–æ–Ω–∫–∏!")
    print("üìÅ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Ç—Ä–µ—è:")
    print("   üì± tray-icon.png - –∫–æ–º–ø–∞–∫—Ç–Ω–∞—è –∏–∫–æ–Ω–∫–∞ (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä)")
    print("   üåô tray-icon-dark.png - –∫–æ–º–ø–∞–∫—Ç–Ω–∞—è —Ç–µ–º–Ω–∞—è –∏–∫–æ–Ω–∫–∞ (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä)")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤
    compact_files = ["tray-icon.png", "tray-icon-dark.png"]
    print("\nüìä –†–∞–∑–º–µ—Ä—ã –∫–æ–º–ø–∞–∫—Ç–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:")
    for filename in compact_files:
        filepath = f"iconset-work/{filename}"
        if os.path.exists(filepath):
            size = os.path.getsize(filepath)
            print(f"   ‚úÖ {filename}: {size} –±–∞–π—Ç (–∫–æ–º–ø–∞–∫—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è)")
    
    print("\nüí° –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∫–æ–º–ø–∞–∫—Ç–Ω—ã—Ö –∏–∫–æ–Ω–æ–∫:")
    print("   ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞")
    print("   ‚úÖ –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ç–µ–∫—Å—Ç 'I2P' —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –æ—Ç—Å—Ç—É–ø–∞–º–∏")
    print("   ‚úÖ –õ–µ–≥–∫–∏–µ —Ç–µ–Ω–∏ –¥–ª—è —á–µ—Ç–∫–æ—Å—Ç–∏ –±–µ–∑ —É–≤–µ–ª–∏—á–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞")
    print("   ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞")
    
    return True

if __name__ == "__main__":
    try:
        success = create_compact_tray_icons()
        if success:
            print("\n‚úÖ –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –∏–∫–æ–Ω–∫–∏ —Å–æ–∑–¥–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ!")
            print("üöÄ –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞!")
        else:
            print("\n‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–∞–∫—Ç–Ω—ã–µ –∏–∫–æ–Ω–∫–∏")
            exit(1)
    except Exception as e:
        print(f"\n‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–ø–∞–∫—Ç–Ω—ã—Ö –∏–∫–æ–Ω–æ–∫: {e}")
        exit(1)
