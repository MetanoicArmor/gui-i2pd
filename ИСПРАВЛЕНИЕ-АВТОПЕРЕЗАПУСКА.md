# üîÑ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ daemon

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞
**"–ø–æ—Å–ª–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–µ–º–æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –Ω–µ—Å—É–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥"**

Daemon –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª—Å—è, –Ω–æ –∑–∞—Ç–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–ª—Å—è –æ–±—Ä–∞—Ç–Ω–æ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥.

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞:
1. **–ë—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏** - –ø–æ–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ—Å—Ç–∞–Ω–æ–≤–∫–∞, —Å—Ç–∞—Ç—É—Å `isRunning` –∏–∑–º–µ–Ω—è–µ—Ç—Å—è –∏ –∫–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è —Å "–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å" –Ω–∞ "–ó–∞–ø—É—Å—Ç–∏—Ç—å"
2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ restartDaemon()** - —Å–ª—É—á–∞–π–Ω–æ–µ –Ω–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ "–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å"
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–∞** - —Ç–∞–π–º–µ—Ä –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã
4. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –Ω–∞–∂–∞—Ç–∏—è** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—ã—Å—Ç—Ä–æ –∫–ª–∏–∫–∞–µ—Ç –∫–Ω–æ–ø–∫—É –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑

### –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:
**–ö–Ω–æ–ø–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç `isRunning`!**

```swift
// ‚ùå –ü—Ä–æ–±–ª–µ–º–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∫–Ω–æ–ø–∫–∏:
if i2pdManager.isRunning {
    i2pdManager.stopDaemon()  // 1. –ó–∞–ø—É—Å–∫–∞–µ–º –æ—Å—Ç–∞–Ω–æ–≤–∫—É
} else {
    i2pdManager.startDaemon() // 2. –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–∏–ª—Å—è - –∑–∞–ø—É—Å–∫–∞–µ–º!
}
```

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –í–æ –≤—Ä–µ–º—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ daemon, —Å—Ç–∞—Ç—É—Å `isRunning` –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—é –∫–Ω–æ–ø–∫–∏.

## üîß –†–µ—à–µ–Ω–∏–µ

### 1. –î–æ–±–∞–≤–ª–µ–Ω —Ñ–ª–∞–≥ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–π
```swift
@Published var operationInProgress = false
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –∫–Ω–æ–ø–∫–∏
```swift
.disabled(i2pdManager.isLoading || i2pdManager.operationInProgress)
```

### 3. –ó–∞—â–∏—Ç–∞ –º–µ—Ç–æ–¥–æ–≤ –æ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤
```swift
func startDaemon() {
    guard !operationInProgress else {
        addLog(.warn, "–û–ø–µ—Ä–∞—Ü–∏—è —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º...")
        return
    }
    operationInProgress = true
    // ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
}

func stopDaemon() {
    guard !operationInProgress else {
        addLog(.warn, "–û–ø–µ—Ä–∞—Ü–∏—è —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º...")
        return
    }
    operationInProgress = true
    // ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
}
```

### 4. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–±—Ä–æ—Å —Ñ–ª–∞–≥–æ–≤
–í—Å—è–∫–∏–π —Ä–∞–∑ –∫–æ–≥–¥–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è (—É—Å–ø–µ—à–Ω–æ –∏–ª–∏ —Å –æ—à–∏–±–∫–æ–π), –æ–±–∞ —Ñ–ª–∞–≥–∞ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è:
```swift
self?.isLoading = false
self?.operationInProgress = false
```

## üéØ –ú–µ—Å—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–ª–∞–≥–∞ `operationInProgress`

### ‚úÖ –í –º–µ—Ç–æ–¥–∞—Ö –∑–∞–ø—É—Å–∫–∞:
- `startDaemon()`: —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–ª–∞–≥–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ guard
- Error handling –≤ `startDaemon()`: —Å–±—Ä–æ—Å —Ñ–ª–∞–≥–∞ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- Success handling –≤ `executeI2pdCommand()`: —Å–±—Ä–æ—Å —Ñ–ª–∞–≥–∞ –ø—Ä–∏ —É—Å–ø–µ—Ö–µ

### ‚úÖ –í –º–µ—Ç–æ–¥–∞—Ö –æ—Å—Ç–∞–Ω–æ–≤–∫–∏:
- `stopDaemon()`: —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–ª–∞–≥–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ guard
- Error handling –≤ `stopDaemonProcess()`: —Å–±—Ä–æ—Å —Ñ–ª–∞–≥–∞ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- Success handling –≤ `stopDaemonProcess()`: —Å–±—Ä–æ—Å —Ñ–ª–∞–≥–∞ –ø—Ä–∏ —É—Å–ø–µ—Ö–µ

### ‚úÖ –í –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—Ç–∞—Ç—É—Å–∞:
- `checkDaemonStatus()`: —Å–±—Ä–æ—Å —Ñ–ª–∞–≥–∞ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏

## üõ°Ô∏è –ú–µ—Ö–∞–Ω–∏–∑–º –∑–∞—â–∏—Ç—ã

### –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–≤–æ–π–Ω—ã—Ö –∫–ª–∏–∫–æ–≤:
```swift
guard !operationInProgress else {
    addLog(.warn, "–û–ø–µ—Ä–∞—Ü–∏—è —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º...")
    return
}
```

### –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ UI:
```swift
.disabled(i2pdManager.isLoading || i2pdManager.operationInProgress)
```

### –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:
–ö–∞–∂–¥–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –∑–∞–ø—É—Å–∫–∞/–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–µ–ø–µ—Ä—å –∞—Ç–æ–º–∞—Ä–Ω–∞—è - –Ω–µ–ª—å–∑—è –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–æ–≤—É—é –æ–ø–µ—Ä–∞—Ü–∏—é –ø–æ–∫–∞ —Ç–µ–∫—É—â–∞—è –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞.

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:
1. **–ù–µ—Ç –¥–≤–æ–π–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤** –º–µ—Ç–æ–¥–æ–≤ start/stop –æ–¥–Ω–æ–π –∫–Ω–æ–ø–∫–æ–π
2. **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–∫–∏** –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
3. **–ó–∞—â–∏—Ç–∞ –æ—Ç –∞–≤—Ç–æ–∫–ª–∏–∫–æ–≤** –∏–∑-–∑–∞ –±—ã—Å—Ç—Ä–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π** –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å" ‚Üí –∫–Ω–æ–ø–∫–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è
2. Daemon –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è ‚Üí —Ñ–ª–∞–≥–∏ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è
3. –ö–Ω–æ–ø–∫–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–ó–∞–ø—É—Å—Ç–∏—Ç—å"
4. **–ù–ï–¢ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞!**

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

**–í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚úÖ **–§–ª–∞–≥ `operationInProgress`** –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚úÖ **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–∫–∏** –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ **Guard –ø—Ä–æ–≤–µ—Ä–∫–∏** –≤ –º–µ—Ç–æ–¥–∞—Ö start/stop
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–±—Ä–æ—Å —Ñ–ª–∞–≥–æ–≤** –≤–æ –≤—Å–µ—Ö –º–µ—Å—Ç–∞—Ö
- ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π** –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

**–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–ø–µ—Ä—å –∑–∞—â–∏—â–µ–Ω–æ –æ—Ç –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ daemon!**

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ç–µ–ø–µ—Ä—å:
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å daemon
2. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å daemon  
3. –ü–æ–¥–æ–∂–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥

Daemon –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º –∏ –ù–ï –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏! üéâ
